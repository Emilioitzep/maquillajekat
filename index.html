<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Makeupkat - Tienda y Gestión</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    /* Aquí va el mismo CSS que antes */
  </style>
</head>
<body>
  <header>
    <h1>Makeupkat</h1>
  </header>

  <button class="toggle-btn" id="toggleBtn">Ir a Gestión</button>

  <div class="container">
    <!-- Login -->
    <div class="login-section active" id="loginSection">
      <h2>Iniciar Sesión</h2>
      <input type="password" id="passwordInput" placeholder="Contraseña" />
      <button id="loginBtn">Ingresar</button>
    </div>

    <!-- Gestión -->
    <div class="gestion-section" id="gestionSection">
      <h2>Gestión de Productos</h2>
      <div class="form-section">
        <input
          type="text"
          id="productName"
          placeholder="Nombre del producto"
        />
        <input
          type="number"
          id="productPrice"
          placeholder="Precio (Q)"
          step="0.01"
        />
        <input
          type="text"
          id="productImage"
          placeholder="URL de la imagen"
        />
        <button id="addProductBtn">Agregar Producto</button>
      </div>
      <div class="product-list" id="productList"></div>
    </div>

    <!-- Tienda -->
    <div class="tienda-section" id="tiendaSection">
      <div class="productos" id="productGrid"></div>
    </div>
  </div>

  <div class="carrito" id="carrito">
    <h2>Carrito</h2>
    <ul id="listaCarrito"></ul>
    <p>
      Total: Q<span id="total">0.00</span>
    </p>
    <button class="finalizar-btn" id="finalizarBtn">Finalizar pedido</button>
  </div>

  <footer>
    <p>© 2025 Makeupkat. Todos los derechos reservados.</p>
    <p>
      <a href="https://wa.me/50249080900" target="_blank">WhatsApp</a>
    </p>
  </footer>

  <script>
    const password = "fabiola123";

    let products = JSON.parse(localStorage.getItem("products")) || [
      {
        name: "Base Líquida",
        price: 120,
        image: "https://via.placeholder.com/200x150",
      },
      {
        name: "Labial Matte",
        price: 50,
        image: "https://via.placeholder.com/200x150",
      },
    ];

    let carrito = JSON.parse(localStorage.getItem("carrito")) || [];

    const loginSection = document.getElementById("loginSection");
    const gestionSection = document.getElementById("gestionSection");
    const tiendaSection = document.getElementById("tiendaSection");
    const toggleBtn = document.getElementById("toggleBtn");
    const loginBtn = document.getElementById("loginBtn");
    const addProductBtn = document.getElementById("addProductBtn");
    const finalizarBtn = document.getElementById("finalizarBtn");

    // Mostrar productos en gestión con botón borrar
    function displayProductsGestion() {
      const productList = document.getElementById("productList");
      productList.innerHTML = "";
      products.forEach((product, index) => {
        const productItem = document.createElement("div");
        productItem.className = "product-item";
        productItem.innerHTML = `
          <img src="${product.image}" alt="${product.name}" />
          <div>
            <h3>${product.name}</h3>
            <p>Q${product.price.toFixed(2)}</p>
          </div>
          <button onclick="deleteProduct(${index})">Borrar</button>
        `;
        productList.appendChild(productItem);
      });
    }

    // Mostrar productos en tienda para comprar
    function displayProductsTienda() {
      const productGrid = document.getElementById("productGrid");
      productGrid.innerHTML = "";
      products.forEach((product) => {
        const producto = document.createElement("div");
        producto.className = "producto";
        producto.innerHTML = `
          <img src="${product.image}" alt="${product.name}" />
          <h3>${product.name}</h3>
          <p>Q${product.price.toFixed(2)}</p>
          <button onclick="agregarAlCarrito('${product.name}', ${product.price})">Agregar al carrito</button>
        `;
        productGrid.appendChild(producto);
      });
      if (products.length === 0) {
        productGrid.innerHTML = "<p>No hay productos disponibles.</p>";
      }
    }

    // Agregar producto nuevo
    function addProduct() {
      const name = document.getElementById("productName").value.trim();
      const price = parseFloat(document.getElementById("productPrice").value);
      const image = document.getElementById("productImage").value.trim();

      if (!name || isNaN(price) || price <= 0 || !image) {
        alert("Por favor, completa todos los campos con datos válidos.");
        return;
      }

      products.push({ name, price, image });
      localStorage.setItem("products", JSON.stringify(products));
      displayProductsGestion();
      displayProductsTienda();

      document.getElementById("productName").value = "";
      document.getElementById("productPrice").value = "";
      document.getElementById("productImage").value = "";
    }

    // Borrar producto (función global para onclick)
    function deleteProduct(index) {
      if (confirm(`¿Seguro que quieres borrar "${products[index].name}"?`)) {
        products.splice(index, 1);
        localStorage.setItem("products", JSON.stringify(products));
        displayProductsGestion();
        displayProductsTienda();
        // También limpia el carrito si algún producto borrado estaba ahí
        carrito = carrito.filter((item) => item.name !== products[index]?.name);
        localStorage.setItem("carrito", JSON.stringify(carrito));
        displayCarrito();
      }
    }

    // Agregar producto al carrito
    function agregarAlCarrito(name, price) {
      const productoExistente = carrito.find((item) => item.name === name);
      if (productoExistente) {
        productoExistente.cantidad += 1;
      } else {
        carrito.push({ name, price, cantidad: 1 });
      }
      localStorage.setItem("carrito", JSON.stringify(carrito));
      displayCarrito();
    }

    // Mostrar carrito
    function displayCarrito() {
      const listaCarrito = document.getElementById("listaCarrito");
      const totalSpan = document.getElementById("total");
      listaCarrito.innerHTML = "";

      let total = 0;

      carrito.forEach((item, index) => {
        const li = document.createElement("li");
        li.innerHTML = `
          ${item.name} - Q${item.price.toFixed(2)} x ${item.cantidad}
          <button onclick="eliminarDelCarrito(${index})">X</button>
        `;
        listaCarrito.appendChild(li);
        total += item.price * item.cantidad;
      });

      totalSpan.textContent = total.toFixed(2);
    }

    // Eliminar producto del carrito
    function eliminarDelCarrito(index) {
      carrito.splice(index, 1);
      localStorage.setItem("carrito", JSON.stringify(carrito));
      displayCarrito();
    }

    // Finalizar pedido y enviar por WhatsApp
    function finalizarPedido() {
      if (carrito.length === 0) {
        alert("El carrito está vacío.");
        return;
      }

      let mensaje = "¡Hola! Quiero hacer este pedido:%0A";
      carrito.forEach((item) => {
        mensaje += `- ${item.name} x${item.cantidad}%0A`;
      });

      let total = carrito.reduce(
        (acc, item) => acc + item.price * item.cantidad,
        0
      );
      mensaje += `%0ATotal: Q${total.toFixed(2)}`;

      // Número de WhatsApp, ajusta si quieres
      const telefono = "50249080900";
      const url = `https://wa.me/${telefono}?text=${mensaje}`;

      // Abrir WhatsApp con el mensaje
      window.open(url, "_blank");

      // Vaciar carrito después de enviar pedido
      carrito = [];
      localStorage.setItem("carrito", JSON.stringify(carrito));
      displayCarrito();
    }

    // Alternar entre gestión y tienda
    function toggleView() {
      if (gestionSection.classList.contains("active")) {
        gestionSection.classList.remove("active");
        tiendaSection.classList.add("active");
        toggleBtn.textContent = "Ir a Gestión";
      } else {
        gestionSection.classList.add("active");
        tiendaSection.classList.remove("active");
        toggleBtn.textContent = "Ir a Tienda";
      }
    }

    // Login
    loginBtn.addEventListener("click", () => {
      const inputPass = document.getElementById("passwordInput").value;
      if (inputPass === password) {
        loginSection.style.display = "none";
        gestionSection.classList.add("active");
        tiendaSection.classList.add("active");
        toggleBtn.style.display = "inline-block";
        displayProductsGestion();
        displayProductsTienda();
        displayCarrito();
      } else {
        alert("Contraseña incorrecta.");
      }
    });

    toggleBtn.addEventListener("click", () => {
      toggleView();
    });

    addProductBtn.addEventListener("click", addProduct);
    finalizarBtn.addEventListener("click", finalizarPedido);

    // Mostrar solo tienda y carrito si ya estaba logueado antes (opcional)
    if (localStorage.getItem("loggedIn") === "true") {
      loginSection.style.display = "none";
      gestionSection.classList.add("active");
      tiendaSection.classList.add("active");
      toggleBtn.style.display = "inline-block";
      displayProductsGestion();
      displayProductsTienda();
      displayCarrito();
    }
  </script>
</body>
</html>
